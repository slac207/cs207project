<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cs207rbtree.RedBlackTree &mdash; cs207project 0.0.post0.dev372+n1d712dc documentation</title>
    
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.post0.dev372+n1d712dc',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="cs207project 0.0.post0.dev372+n1d712dc documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cs207rbtree.RedBlackTree</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">pickle</span>      <span class="c1"># for BinaryNodeRef class</span>
<span class="kn">import</span> <span class="nn">os</span>          <span class="c1"># for Storage class</span>
<span class="kn">import</span> <span class="nn">struct</span>      <span class="c1"># for Storage class</span>
<span class="kn">import</span> <span class="nn">portalocker</span> <span class="c1"># for Storage class</span>


<div class="viewcode-block" id="Color"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Color">[docs]</a><span class="k">class</span> <span class="nc">Color</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class that defines the coloring of our red-black tree, and </span>
<span class="sd">    the corresponding underlying values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">BLACK</span> <span class="o">=</span> <span class="mi">1</span></div>

    
<div class="viewcode-block" id="ValueRef"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.ValueRef">[docs]</a><span class="k">class</span> <span class="nc">ValueRef</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A ValueRef object is a reference to a string value on disk.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">referent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class constructor. </span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          referent: value (a string) to store on disk [optional]</span>
<span class="sd">          address : integer indicating where to store `_referent`</span>
<span class="sd">                    (number of bytes from beginning of file)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_referent</span> <span class="o">=</span> <span class="n">referent</span> <span class="c1"># value to store</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_address</span>  <span class="o">=</span> <span class="n">address</span>  <span class="c1"># address to store at</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span>

<div class="viewcode-block" id="ValueRef.prepare_to_store"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.ValueRef.prepare_to_store">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_to_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
        <span class="c1"># Not implemented</span>
        <span class="k">pass</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ValueRef.referent_to_bytes"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.ValueRef.referent_to_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">referent_to_bytes</span><span class="p">(</span><span class="n">referent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts `referent` to bytes, in preparation for disk storage.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          referent: value (a string) to be encoded</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">          A bytes representation of the Unicode string, </span>
<span class="sd">            encoded in UTF-8.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">referent</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="ValueRef.bytes_to_referent"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.ValueRef.bytes_to_referent">[docs]</a>    <span class="k">def</span> <span class="nf">bytes_to_referent</span><span class="p">(</span><span class="nb">bytes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts `bytes` to a string, typically after reading `bytes` </span>
<span class="sd">          from disk.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          referent: value (a string) to be encoded</span>
<span class="sd">          </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">          A bytes representation of the Unicode string, </span>
<span class="sd">            encoded in UTF-8.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ValueRef.get"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.ValueRef.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads whatever bytes are at the `_address` attribute,</span>
<span class="sd">           converts to a string,</span>
<span class="sd">           saves this string as `_referent`, and and returns it.</span>
<span class="sd">           </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          storage: a Storage object</span>
<span class="sd">                   (our Python representation of our data on disk)</span>
<span class="sd">                   </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">          The string located at the `_address` attribute in `storage`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_referent</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_referent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bytes_to_referent</span><span class="p">(</span><span class="n">storage</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_referent</span></div>

<div class="viewcode-block" id="ValueRef.store"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.ValueRef.store">[docs]</a>    <span class="k">def</span> <span class="nf">store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts whatever value is contained in the `_referent`</span>
<span class="sd">          attribute to bytes, saves it to disk within `storage`, </span>
<span class="sd">          and records the storage address.`, and and returns it.</span>
<span class="sd">           </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          storage: a Storage object</span>
<span class="sd">                   (our Python representation of our data on disk)</span>
<span class="sd">                   </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">          None.</span>
<span class="sd">          </span>
<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method is called by BinaryNode.store_refs() </span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_referent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_address</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prepare_to_store</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_address</span> <span class="o">=</span> <span class="n">storage</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">referent_to_bytes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_referent</span><span class="p">))</span></div></div>

    
<div class="viewcode-block" id="RedBlackNodeRef"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNodeRef">[docs]</a><span class="k">class</span> <span class="nc">RedBlackNodeRef</span><span class="p">(</span><span class="n">ValueRef</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A RedBlackNodeRef object is a reference to a red-black </span>
<span class="sd">      binary tree node on disk.</span>
<span class="sd">    Inherits from ValueRef.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="RedBlackNodeRef.prepare_to_store"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNodeRef.prepare_to_store">[docs]</a>    <span class="k">def</span> <span class="nf">prepare_to_store</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Have a node store its refs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_referent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_referent</span><span class="o">.</span><span class="n">store_refs</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>    </div>
    
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="RedBlackNodeRef.referent_to_bytes"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNodeRef.referent_to_bytes">[docs]</a>    <span class="k">def</span> <span class="nf">referent_to_bytes</span><span class="p">(</span><span class="n">referent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serializes the tree node (i.e., pickles the tree node) </span>
<span class="sd">          in preparation for disk storage.</span>
<span class="sd">           </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          referent: node to be encoded</span>
<span class="sd">                   </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">          A serialized tree node (e.g., a serialized BinaryNode object).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
            <span class="s1">&#39;left&#39;</span> <span class="p">:</span> <span class="n">referent</span><span class="o">.</span><span class="n">left_ref</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
            <span class="s1">&#39;key&#39;</span>  <span class="p">:</span> <span class="n">referent</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">referent</span><span class="o">.</span><span class="n">value_ref</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
            <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">referent</span><span class="o">.</span><span class="n">right_ref</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
            <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">referent</span><span class="o">.</span><span class="n">color</span>
        <span class="p">})</span></div>

    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="RedBlackNodeRef.bytes_to_referent"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNodeRef.bytes_to_referent">[docs]</a>    <span class="k">def</span> <span class="nf">bytes_to_referent</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deserializes the tree node (i.e., unpickles the tree node) </span>
<span class="sd">          typically after disk retrieval.</span>
<span class="sd">           </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          string: value to be reconstituted</span>
<span class="sd">                   </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">          A reconstituted RedBlackNode object.</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="n">d</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">RedBlackNode</span><span class="p">(</span>
            <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]),</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;key&#39;</span><span class="p">],</span>
            <span class="n">ValueRef</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]),</span>
            <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]),</span>
            <span class="n">d</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
        <span class="p">)</span>    </div></div>

        
        
<div class="viewcode-block" id="RedBlackNode"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNode">[docs]</a><span class="k">class</span> <span class="nc">RedBlackNode</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A RedBlackNode object contains the data of a single node in a </span>
<span class="sd">      binary tree, and stores references to the data and its two</span>
<span class="sd">      child nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="RedBlackNode.from_node"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNode.from_node">[docs]</a>    <span class="k">def</span> <span class="nf">from_node</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clones a node, but with updates as specified by addtional arguments.</span>
<span class="sd">           </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          node:     tree node to be cloned</span>
<span class="sd">          **kwargs: tree node attributes to be updated</span>
<span class="sd">                   </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">          An updated RedBlackNode object.</span>
<span class="sd">        &quot;&quot;&quot;</span>           
        <span class="k">return</span> <span class="n">cls</span><span class="p">(</span>
            <span class="n">left_ref</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;left_ref&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">),</span>
            <span class="n">key</span>       <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">),</span>
            <span class="n">value_ref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value_ref&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">value_ref</span><span class="p">),</span>
            <span class="n">right_ref</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;right_ref&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">),</span>
            <span class="n">color</span>     <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">color</span><span class="p">),</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left_ref</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_ref</span><span class="p">,</span> <span class="n">right_ref</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class constructor.</span>
<span class="sd">        A BinaryNode object consists of its data value, its address, </span>
<span class="sd">          and the addresses of its two children.</span>
<span class="sd">           </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          left_ref:  address of left child (e.g., number of bytes from  </span>
<span class="sd">                     start of file on disk, or ValueRef object)</span>
<span class="sd">          key:       string associated with the data value stored</span>
<span class="sd">                     in the tree.</span>
<span class="sd">          value_ref: address of data value stored in this node</span>
<span class="sd">          right_ref: address of right child </span>
<span class="sd">          color:     color of the node (default color is red).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_ref</span>  <span class="o">=</span> <span class="n">left_ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span>       <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_ref</span> <span class="o">=</span> <span class="n">value_ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_ref</span> <span class="o">=</span> <span class="n">right_ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span>     <span class="o">=</span> <span class="n">color</span>    
        
        
<div class="viewcode-block" id="RedBlackNode.store_refs"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNode.store_refs">[docs]</a>    <span class="k">def</span> <span class="nf">store_refs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method for RedBlackNode object to save its contents to disk.</span>
<span class="sd">        Recursively stores the entire tree to disk.</span>
<span class="sd">           </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">          storage: a Storage object</span>
<span class="sd">                   (our Python representation of our data on disk)                  </span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">value_ref</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left_ref</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">right_ref</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="n">storage</span><span class="p">)</span>    </div>
        
<div class="viewcode-block" id="RedBlackNode.blacken"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNode.blacken">[docs]</a>    <span class="k">def</span> <span class="nf">blacken</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>
    
<div class="viewcode-block" id="RedBlackNode.is_red"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNode.is_red">[docs]</a>    <span class="k">def</span> <span class="nf">is_red</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check is node is colored black &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span></div>
    
<div class="viewcode-block" id="RedBlackNode.is_black"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackNode.is_black">[docs]</a>    <span class="k">def</span> <span class="nf">is_black</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check is node is colored red &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">==</span> <span class="n">Color</span><span class="o">.</span><span class="n">BLACK</span></div></div>

            
<div class="viewcode-block" id="RedBlackTree"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree">[docs]</a><span class="k">class</span> <span class="nc">RedBlackTree</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Red Black Binary Tree class. </span>
<span class="sd">    Inherits from BinaryTree class, so is immutable as well </span>
<span class="sd">      (i.e., constructs new tree on changes).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">storage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span> <span class="o">=</span> <span class="n">storage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_tree_ref</span><span class="p">()</span>
        
<div class="viewcode-block" id="RedBlackTree.commit"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree_ref</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">commit_root_address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_ref</span><span class="o">.</span><span class="n">address</span><span class="p">)</span>        </div>

    <span class="k">def</span> <span class="nf">_refresh_tree_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets reference to new tree if it has changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree_ref</span> <span class="o">=</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span>
            <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">get_root_address</span><span class="p">())</span>        

<div class="viewcode-block" id="RedBlackTree.set"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets a new value in the tree, causing a new tree to be created</span>
<span class="sd">        (b/c of immutability).</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        key:   indexes the value that we want to store</span>
<span class="sd">        value: the data we want to store, under `key`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># try to lock the tree. If we succeed make sure</span>
        <span class="c1"># we don&#39;t lose updates from any other process</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">lock</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_tree_ref</span><span class="p">()</span>
        <span class="c1"># get current top-level node and make a value-ref</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_ref</span><span class="p">)</span>
        <span class="n">value_ref</span> <span class="o">=</span> <span class="n">ValueRef</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># insert and get new tree ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_ref</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RedBlackTree.get"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves the value associated with the specified key.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        key: indexes the value that we want to retrieve</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The value associated with `key`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if tree is not locked by another writer</span>
        <span class="c1"># refresh the references and get new tree if needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">locked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_tree_ref</span><span class="p">()</span>
        <span class="c1"># get the top level node</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_ref</span><span class="p">)</span>
        <span class="c1"># traverse until you find appropriate node</span>
        <span class="k">while</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span> 
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value_ref</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span>    </div>
        
<div class="viewcode-block" id="RedBlackTree.rotate_left"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.rotate_left">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_left</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates the specified node &quot;to the left&quot;, in order to ensure compliance</span>
<span class="sd">          with red-black tree invariants (see module README), in particular </span>
<span class="sd">          &quot;No red node has a red parent.&quot; This method is used when `node` has</span>
<span class="sd">          a red parent. </span>
<span class="sd">        </span>
<span class="sd">        A &quot;left rotation&quot; is when we switch the positions of `node` and</span>
<span class="sd">          its right child (call it RC) -- so `node` becomes the left child of RC.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        node:      RedBlackNode object (or None if our key/value has</span>
<span class="sd">                   not been packaged as such)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A RedBlackNodeRef object that points to the new node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rotatedChild</span> <span class="o">=</span> <span class="n">RedBlackNode</span><span class="p">(</span><span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span>
            <span class="n">node</span><span class="p">,</span>
            <span class="n">right_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)),</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span><span class="o">.</span><span class="n">value_ref</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span><span class="o">.</span><span class="n">right_ref</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">rotatedChild</span></div>
        
<div class="viewcode-block" id="RedBlackTree.rotate_right"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.rotate_right">[docs]</a>    <span class="k">def</span> <span class="nf">rotate_right</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Rotates the specified node &quot;to the right&quot;, in order to ensure compliance</span>
<span class="sd">          with red-black tree invariants (see module README), in particular </span>
<span class="sd">          &quot;No red node has a red parent.&quot; This method is used when `node` has</span>
<span class="sd">          a red parent. </span>
<span class="sd">        </span>
<span class="sd">        A &quot;right rotation&quot; is when we switch the positions of `node` and</span>
<span class="sd">          its left child (call it LC) -- so `node` becomes the right child of LC.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        node:      RedBlackNode object</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A RedBlackNodeRef object that points to the new node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rotatedChild</span> <span class="o">=</span> <span class="n">RedBlackNode</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">left_ref</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">value_ref</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>            
            
            <span class="n">RedBlackNodeRef</span><span class="p">(</span>
                <span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span>
                    <span class="n">node</span><span class="p">,</span>
                    <span class="n">left_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">color</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">rotatedChild</span></div>
        
        
<div class="viewcode-block" id="RedBlackTree.recolor"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.recolor">[docs]</a>    <span class="k">def</span> <span class="nf">recolor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets `node` color to red and the color of its children to black.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        node:      RedBlackNode object </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The new recolored node.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">leftChild</span>  <span class="o">=</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_blacken</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)))</span>
        <span class="n">rightChild</span> <span class="o">=</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_blacken</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)))</span>        
        
        <span class="k">return</span> <span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span>
                                      <span class="n">left_ref</span>  <span class="o">=</span> <span class="n">leftChild</span><span class="p">,</span>
                                      <span class="n">right_ref</span> <span class="o">=</span> <span class="n">rightChild</span><span class="p">,</span>
                                      <span class="n">color</span>     <span class="o">=</span> <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="RedBlackTree.balance"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.balance">[docs]</a>    <span class="k">def</span> <span class="nf">balance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span> 
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a new node to the tree, then balance.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        node:      RedBlackNode object </span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The node that was passed to the function.   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if new node is already red, we&#39;re done.</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">node</span>
        
        <span class="n">leftChild</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span>
        <span class="n">rightChild</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">leftChild</span> <span class="ow">and</span> <span class="n">leftChild</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span> 
            <span class="c1"># if the left and right children are red, </span>
            <span class="c1"># make `node` red and its children black (i.e., recolor)</span>
            <span class="k">if</span> <span class="n">rightChild</span> <span class="ow">and</span> <span class="n">rightChild</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span> 
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            
            <span class="c1"># if this particular grandchild is red,</span>
            <span class="c1">#   rotate then recolor</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">leftChild</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_right</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="c1"># if this particular grandchild is red,</span>
            <span class="c1">#   rotate then recolor</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">leftChild</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span>
                <span class="n">new_leftChild</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_left</span><span class="p">(</span><span class="n">leftChild</span><span class="p">)</span>
                <span class="n">newNode</span> <span class="o">=</span> <span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span>
                                                 <span class="n">left_ref</span> <span class="o">=</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="n">new_leftChild</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_right</span><span class="p">(</span><span class="n">newNode</span><span class="p">))</span>
        
        <span class="c1"># the process we did above for the left child, we repeat for the right</span>
        <span class="k">if</span> <span class="n">rightChild</span> <span class="ow">and</span> <span class="n">rightChild</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">rightChild</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_left</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">rightChild</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span><span class="o">.</span><span class="n">is_red</span><span class="p">():</span>
                <span class="n">new_rightChild</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_right</span><span class="p">(</span><span class="n">rightChild</span><span class="p">)</span>
                <span class="n">newNode</span> <span class="o">=</span> <span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span>
                                                 <span class="n">right_ref</span> <span class="o">=</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="n">new_rightChild</span><span class="p">))</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">recolor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate_left</span><span class="p">(</span><span class="n">newNode</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">node</span> </div>
         
    
<div class="viewcode-block" id="RedBlackTree.get_nodes_less_than"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.get_nodes_less_than">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_less_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Find all nodes that have a key value &lt;= &#39;key&#39;&quot;&quot;&quot;</span>
        <span class="c1">#if tree is not locked by another writer</span>
        <span class="c1">#refresh the references and get new tree if needed</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">locked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_refresh_tree_ref</span><span class="p">()</span>
            
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tree_ref</span><span class="p">)</span>
        <span class="n">stack</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">stack</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">stack</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span> <span class="o">&gt;</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">solution</span>
                <span class="n">solution</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">value_ref</span><span class="p">))</span>
                <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">solution</span> </div>
    
    <span class="k">def</span> <span class="nf">_insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a new node creating a new path from tree root.</span>
<span class="sd">        </span>
<span class="sd">        Args</span>
<span class="sd">        ----</span>
<span class="sd">        node:      RedBlackNode object </span>
<span class="sd">        key:       indexes the value that we want to store</span>
<span class="sd">        value_ref: address of data value stored in this node</span>
<span class="sd">                   (number of bytes from start of file on disk)</span>
<span class="sd">        </span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A RedBlackNodeRef object that points to the new node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">node</span><span class="p">,</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">value_ref</span><span class="p">))</span><span class="o">.</span><span class="n">blacken</span><span class="p">())</span>
                                            
    <span class="k">def</span> <span class="nf">_follow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a node from a reference</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">ref</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">)</span>   
    
    
<div class="viewcode-block" id="RedBlackTree.update"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.RedBlackTree.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_ref</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Recursively update and balance along the way&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">RedBlackNode</span><span class="p">(</span>
                <span class="n">RedBlackNodeRef</span><span class="p">(),</span> 
                <span class="n">key</span><span class="p">,</span> 
                <span class="n">value_ref</span><span class="p">,</span> 
                <span class="n">RedBlackNodeRef</span><span class="p">(),</span> 
                <span class="n">Color</span><span class="o">.</span><span class="n">RED</span><span class="p">)))</span>  
        <span class="k">elif</span> <span class="n">key</span><span class="o">==</span><span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span>
                <span class="n">node</span><span class="p">,</span> <span class="n">value_ref</span><span class="o">=</span><span class="n">value_ref</span><span class="p">)))</span>       
        
        <span class="k">elif</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span>
                <span class="n">left_ref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">left_ref</span><span class="p">),</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_ref</span><span class="p">))))</span>        
        <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">key</span> <span class="o">&lt;</span> <span class="n">key</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RedBlackNodeRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">balance</span><span class="p">(</span><span class="n">RedBlackNode</span><span class="o">.</span><span class="n">from_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span>
                <span class="n">right_ref</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_follow</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">right_ref</span><span class="p">),</span> <span class="n">key</span><span class="p">,</span> <span class="n">value_ref</span><span class="p">))))</span>      </div></div>

            
<div class="viewcode-block" id="Storage"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage">[docs]</a><span class="k">class</span> <span class="nc">Storage</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Storage class to interact with the file on disk.</span>
<span class="sd">    Manages writing to file, locking/unlocking for editing, and closing the file.&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">SUPERBLOCK_SIZE</span> <span class="o">=</span> <span class="mi">4096</span>
    <span class="n">INTEGER_FORMAT</span>  <span class="o">=</span> <span class="s2">&quot;!Q&quot;</span>
    <span class="n">INTEGER_LENGTH</span>  <span class="o">=</span> <span class="mi">8</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `f` is an open file object (e.g., returned by built-in method open())</span>
<span class="sd">        The constructor stores `f`, sets the object state to unlocked, and</span>
<span class="sd">          ensures we start storage within the sector boundary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span> <span class="o">=</span> <span class="n">f</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_superblock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_ensure_superblock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Guarantees that the next write will start on a sector boundary.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_end</span><span class="p">()</span>
        <span class="n">end_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">end_address</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">SUPERBLOCK_SIZE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">b</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SUPERBLOCK_SIZE</span> <span class="o">-</span> <span class="n">end_address</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>

<div class="viewcode-block" id="Storage.lock"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;If not locked, lock the file for writing and return True.&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span><span class="p">:</span>
            <span class="n">portalocker</span><span class="o">.</span><span class="n">lock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">,</span> <span class="n">portalocker</span><span class="o">.</span><span class="n">LOCK_EX</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span></div>

<div class="viewcode-block" id="Storage.unlock"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage.unlock">[docs]</a>    <span class="k">def</span> <span class="nf">unlock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;If locked, flush and unlock the file&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">portalocker</span><span class="o">.</span><span class="n">unlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">locked</span> <span class="o">=</span> <span class="bp">False</span></div>

    <span class="k">def</span> <span class="nf">_seek_end</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Move pointer to the end of the file.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">SEEK_END</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_seek_superblock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Go to beginning of file which is on the sector boundary.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bytes_to_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integer_bytes</span><span class="p">):</span>
        <span class="s2">&quot;Use struct to unpack bytes into an integer.&quot;</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INTEGER_FORMAT</span><span class="p">,</span> <span class="n">integer_bytes</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_integer_to_bytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integer</span><span class="p">):</span>
        <span class="s2">&quot;Use struct to pack an integer into bytes.&quot;</span>
        <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INTEGER_FORMAT</span><span class="p">,</span> <span class="n">integer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_read_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Read the next 8 bytes and return the unpacked integer.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bytes_to_integer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">INTEGER_LENGTH</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_write_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">integer</span><span class="p">):</span>
        <span class="s2">&quot;Lock the file and write integer to file.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_integer_to_bytes</span><span class="p">(</span><span class="n">integer</span><span class="p">))</span>

<div class="viewcode-block" id="Storage.write"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="s2">&quot;Write data to disk, returning the address at which you wrote it.&quot;</span>
        <span class="c1"># first lock, get to end, get address to return, write size</span>
        <span class="c1"># write data, unlock &lt;==WRONG, dont want to unlock here</span>
        <span class="c1"># your code here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_end</span><span class="p">()</span>
        <span class="n">object_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_integer</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">object_address</span></div>

<div class="viewcode-block" id="Storage.read"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage.read">[docs]</a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="s2">&quot;Read data from given address in file.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>         <span class="c1"># Move pointer in file</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_integer</span><span class="p">()</span> <span class="c1"># Get the next integer from the file</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span> 
        <span class="k">return</span> <span class="n">data</span></div>

<div class="viewcode-block" id="Storage.commit_root_address"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage.commit_root_address">[docs]</a>    <span class="k">def</span> <span class="nf">commit_root_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Atomically commit changes by writing the new root address to beginning</span>
<span class="sd">        of the next superblock and unlocking the file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>     <span class="c1"># lock self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># finish off sector</span>
        
        <span class="c1"># make sure you write root address at position 0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_superblock</span><span class="p">()</span> <span class="c1"># move pointer to next superblock</span>
        <span class="c1"># write is atomic because we store the address on a sector boundary.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_integer</span><span class="p">(</span><span class="n">root_address</span><span class="p">)</span> <span class="c1"># write the root address to file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># finish off sector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>   <span class="c1"># unlock the file for writing</span></div>

<div class="viewcode-block" id="Storage.get_root_address"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage.get_root_address">[docs]</a>    <span class="k">def</span> <span class="nf">get_root_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Get the root address, as measured from the beginning of the file.&quot;</span>
        <span class="c1">#read the first integer in the file</span>
        <span class="c1">#your code here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_seek_superblock</span><span class="p">()</span>
        <span class="n">root_address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_integer</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">root_address</span></div>

<div class="viewcode-block" id="Storage.close"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.Storage.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Unlock and close the file.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Returns true if database is closed.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="o">.</span><span class="n">closed</span></div>

    
<div class="viewcode-block" id="DBDB"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB">[docs]</a><span class="k">class</span> <span class="nc">DBDB</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Database class to manage Storage and RedBlackTree operations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">    ----------</span>
<span class="sd">    _storage: Storage object to manage file writes/reads</span>
<span class="sd">    _tree: RedBlackTree object to manage a Red Black Tree</span>

<span class="sd">    Example:</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; fd = os.open(&quot;/tmp/test.dbdb&quot;, os.O_RDWR | os.O_CREAT)</span>
<span class="sd">    &gt;&gt;&gt; f  = open(fd, &#39;r+b&#39;)</span>
<span class="sd">    &gt;&gt;&gt; db = DBDB(f)</span>
<span class="sd">    &gt;&gt;&gt; db.set(&quot;rahul&quot;, &quot;aged&quot;)</span>
<span class="sd">    &gt;&gt;&gt; db.set(&quot;kobe&quot;, &quot;stillyoung&quot;)</span>
<span class="sd">    &gt;&gt;&gt; db.get(&quot;rahul&quot;)</span>
<span class="sd">    &#39;aged&#39;</span>
<span class="sd">    &gt;&gt;&gt; db.commit()</span>
<span class="sd">    &gt;&gt;&gt; db.close()</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="s2">&quot;Creates storage and tree properties&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span> <span class="o">=</span> <span class="n">Storage</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span> <span class="o">=</span> <span class="n">RedBlackTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assert_not_closed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Confirm the storage database is closed.&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Database closed.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="DBDB.close"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Close the storage object.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_storage</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

<div class="viewcode-block" id="DBDB.commit"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&quot;Confirm storage is closed and commit.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_not_closed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="DBDB.get"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s2">&quot;Confirm storage is open and get a value for a key.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_not_closed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="DBDB.set"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="s2">&quot;Confirm storage is open and set a value for a key.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_not_closed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="DBDB.delete"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="s2">&quot;Confirm storage is open and delete node with key.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_not_closed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="DBDB.rootKey"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.rootKey">[docs]</a>    <span class="k">def</span> <span class="nf">rootKey</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">rootKey</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="DBDB.get_nodes_less_than"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.get_nodes_less_than">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_less_than</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_not_closed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">get_nodes_less_than</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> </div>
    
<div class="viewcode-block" id="DBDB.in_order_traversal"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.DBDB.in_order_traversal">[docs]</a>    <span class="k">def</span> <span class="nf">in_order_traversal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_not_closed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tree</span><span class="o">.</span><span class="n">in_order_traversal</span><span class="p">()</span> </div></div>
    
<div class="viewcode-block" id="connect"><a class="viewcode-back" href="../../api/cs207rbtree.html#cs207rbtree.RedBlackTree.connect">[docs]</a><span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="n">dbname</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="s1">&#39;r+b&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dbname</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">&#39;r+b&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">DBDB</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Sarah Anoke.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.4.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.8</a>
      
    </div>

    

    
  </body>
</html>