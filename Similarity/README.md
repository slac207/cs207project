# Similarity Module Documentation

## Purpose
This module contains the methods for finding the n most similar timeseries compared to a given timeseries. It uses a Storage Manager (timeseries/StorageManager.py) in order to store the timeseries. We use a Red Black tree (cs207rbtree/RedBlackTree.py) to maintain the Vantage Point databases used to expedite the similarity searches. Each of our randomly chosen 20 timeseries (called Vantage Points) has their own database containing their distance to every other timeseries. 

## Installation
Before running any files, `python setup.py install` must be run from the top level directory, cs207project. 

## Contents
* distances.py
  * Contains functions necessary for generating random timeseries as well as computing the distances between timeseries.
  * Distances are computed by 1) finding the normalized kernalized cross correlation between two timeseries and then 2) the distance is defined to be `2*(1-kernel_coeff)`
* find_most_similar.py
  * Contains function `find_most_similiar` which find the n most similiar timeseries using the vantage point databases and generated timeseries
  * Also contains a function called `sanity_check` which uses a brute force method to check that our vantage point method works
* generate_time_series.py
  * Generates 1000 random timeseries, named ts_[id].npy where 0 <= id <= 999, and stores them using the FileStorageManger
* pick_vantage_points.py
  * Randomly chooses 20 timeseries (called vantage points) and creates a database containing each timeseries distance to the respective vantage point
* VantagePointDatabases: folder containing the RedBlackTree databases for each chosen vantage point
  * Folder which contains the databases generated by pick_vantage_points.py

## Usage
Files must be called in the following order to ensure that the timeseries and vantage point databases have been properly constructed before running the similarity search
1. generate_time_series.py
2. pick_vantage_points.py
3. find_most_similar.py

Below we demonstrate how to search for the n most similiar timeseries to timeseries with id 150. 
```
storage_manager = generate_time_series()
vantage_points = np.array(pick_vantage_points(20,storage_manager)) 
find_most_similiar(150, n, vantage_points, storage_manager)
```

## Testing 
There are two testing files for the code in this module and they are both contained in the [test folder](https://github.com/slac207/cs207project/tree/master/tests). These files can be run using `python setup.py test`. 

1. test_similarity.py: tests the functionality of of the distances.py file. Included tests for whether we standardize timeseries correctly, calculate the kernel coefficient, and calculate the distance between timeseries correctly.
2. test_database.py: tests for the correct behavior in generating timeseries, making the vantage point databases, and similarity searches (as checked by our brute force method) 


